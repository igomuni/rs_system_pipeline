# 予算執行データ単位不整合の分析

生成日時: 2025-10-06

## 問題の概要

2019-2023年のデータと2024年のデータで、**予算額の単位が異なっています**。

### データ形式の違い

| 期間 | 単位 | 例（内閣人事局経費, 2019年度予算） | 出典 |
|------|------|-----------------------------------|------|
| **2019-2023年** | **百万円** | `29.0` (= 2,900万円) | `output/processed/year_YYYY/` |
| **2024年** | **円** | `29,457,000` (= 2,945万7,000円) | `data/unzipped/` |

## 実データ比較

### 内閣人事局経費（2021年度予算）

**2019年レビューシート（事業年度2019、予算年度2021含む）**
```csv
事業年度,予算年度,当初予算(合計),執行額(合計)
2019,2021,-,- (まだ未来のため記録なし)
```

**2021年レビューシート（事業年度2021）**
```csv
事業年度,予算年度,当初予算(合計),執行額(合計)
2021,2021,29,29  ← 百万円単位
```

**2024年レビューシート（事業年度2024、予算年度2021含む）**
```csv
事業年度,予算年度,当初予算(合計),執行額(合計)
2024,2021,29457000,23771000  ← 円単位
```

換算: `29,457,000円 ÷ 1,000,000 = 29.457百万円` ≈ `29百万円`（2021年データ）

## 影響範囲

### 1. 予算変遷追跡における問題

府省庁・事業名で紐付けて予算変遷を追跡する際、**2019-2023年のデータと2024年のデータを直接比較すると100万倍の差が発生**します。

検証ツール(`validate_budget_continuity.py`)が検出した「異常な変動」の大部分は、この単位の違いによるものです:

```
例: 内閣人事局経費
  2021年度 1 → 2021年度 29,457,000 (変化率: 35,593,875倍)
```

これは実際には:
- 2021年レビューシート: `1百万円` (端数処理)
- 2024年レビューシート: `29,457,000円` = `29.457百万円`

### 2. 正しい比較方法

同じ予算年度のデータを比較する場合:
1. **最新の事業年度データを優先**: 過去の修正・補正を反映しているため
2. **単位を統一**: 2024年データを百万円単位に変換 (`値 ÷ 1,000,000`)

### 3. 検出された「異常」の再解釈

#### 誤検出例（単位の違い）

| 事業 | 見かけ上の変動 | 実際 |
|------|----------------|------|
| 個人情報保護委員会 - 広聴・相談業務 | 2021年度 1 → 55,081,000 (5700万倍) | 1百万円 → 55百万円 (55倍) |
| 内閣広報経費 | 2021年度 1 → 69,000,000 (6900万倍) | 1百万円 → 69百万円 (69倍) |

#### 真の異常値（要調査）

データ中の小数値は、本来の百万円単位を整数化する際の端数処理に由来すると思われます:

```
2019年レビューシート:
  内閣人事局経費, 2016年度: 0.6百万円 = 60万円
  内閣人事局経費, 2017年度: 0.657百万円 = 65万7千円
```

これらは本来整数で記録されるべきですが、何らかの処理（執行率計算など）により小数化した可能性があります。

## 2023→2024年の継続率低下の原因

検証結果で2023→2024年の継続率が**56.5%**と他の年度（72-87%）より大幅に低い理由:

### 1. データ形式の変更
- RSシステム2024は新しいフォーマット（円単位、詳細列の追加）
- 府省庁名・事業名の表記が変更された可能性

### 2. 府省庁再編
- デジタル庁の新設・拡大により、事業の所管が変更

### 3. 事業名の変更
同一事業でも名称が変わった場合、単純な文字列一致では継続性を検出できません。

## 推奨事項

### 1. データ正規化処理の追加

パイプラインに単位統一処理を追加:

```python
def normalize_budget_unit(df, year):
    """予算額を百万円単位に統一"""
    if year >= 2024:
        # 2024年以降は円→百万円に変換
        budget_columns = ['当初予算（合計）', '補正予算（合計）', '執行額（合計）']
        for col in budget_columns:
            if col in df.columns:
                df[col] = df[col] / 1_000_000
    return df
```

### 2. 継続性判定の改善

府省庁・事業名の表記ゆれを吸収:
- 全角・半角の統一（既に実施済み）
- 括弧内の補足情報を除去
- 類似度マッチング（レーベンシュタイン距離など）

### 3. 警告の追加

ユーザーが異なる年度のデータを比較する際、単位の違いを警告するメッセージを表示。

### 4. 2024年データの再処理

RSシステム2024データ(`data/unzipped/`)も`Stage03_ProcessTables`を通して処理し、百万円単位に統一されたデータを`output/processed/year_2024/`に出力。

## 結論

### 府省庁・事業名による年度間の紐付け

✅ **可能** - 継続率は平均77.3%（2023→2024を除く）で実用的です。

ただし以下の条件が必要:
1. **単位を統一**: 2024年データを百万円単位に変換
2. **最新データを優先**: 過去年度の予算データは最新のレビューシートから取得
3. **表記ゆれ対策**: 府省庁名・事業名の正規化を強化

### 予算変遷の追跡

✅ **可能** - 同一事業について過去5年分の予算年度データが記録されています。

注意点:
- 各年度のレビューシートに記録された過去データの値が微妙に異なる場合がある
- 最新年度のデータが最も正確（修正・補正を反映）
- 単位統一が必須

### データ品質

⚠️ **要改善**:
1. **高優先度**: 2024年データの単位統一処理を実装
2. **中優先度**: 小数値の発生原因を調査・修正
3. **低優先度**: 2023→2024の継続率低下の詳細分析（事業名変更のマッピング作成）
