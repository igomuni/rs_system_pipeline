# データ構造仕様

## 概要

RSシステム形式の3つのテーブルで構成され、予算事業IDによって紐付けられています。

## テーブル構成

### 1. 基本情報・事業概要 (1-2)

**ファイル名**: `1-2_{year}_基本情報_事業概要.csv`

各事業の基本情報を格納。1行=1事業。

**主要カラム**:
- `予算事業ID`: 年度内での通し番号（1から開始）
- `事業年度`: 対象年度（西暦4桁）
- `事業名`: 事業の正式名称
- `府省庁`: 実施府省庁名
- `事業の目的`: 事業の目的説明
- `事業開始年度`: 事業開始年（西暦）
- `事業終了(予定)年度`: 事業終了予定年（西暦）

**レコード数**: 年度ごとに約4,700〜5,500件

### 2. 予算・執行サマリ (2-1)

**ファイル名**: `2-1_{year}_予算・執行_サマリ.csv`

各事業の予算・執行額を年度別に展開。1事業につき複数年度のレコードを持つ。

**主要カラム**:
- `予算事業ID`: 基本情報テーブルと紐付くID
- `予算年度`: 予算の対象年度
- `当初予算額`: 当初予算額（百万円）
- `補正予算額`: 補正後予算額（百万円）
- `繰越額`: 前年度からの繰越額
- `予算現額`: 実際の予算総額
- `執行額`: 実際の執行額
- `執行率`: 執行率（%）
- `翌年度繰越額`: 翌年度への繰越額

**レコード数**:
- 2014年: 約2.4万件（1事業あたり平均5年度分）
- 2023年: 約8.2万件（1事業あたり平均15年度分）

**注意点**:
- 2014年は2桁年号形式（`-23年度` = 平成23年度）も含む
- 令和・平成の和暦も西暦に変換済み

### 3. 支出先情報 (5-1)

**ファイル名**: `5-1_{year}_支出先_支出情報.csv`

各事業の支出先上位10者の詳細情報。1事業につき最大10レコード。

**主要カラム**:
- `予算事業ID`: 基本情報テーブルと紐付くID
- `支出先ブロック`: ブロック識別子（A, B, C等）※2015年以降
- `支出先番号`: 順位番号（1〜10）
- `支出先名`: 支出先の組織・企業名
- `法人番号`: 法人番号（13桁）
- `業務概要`: 業務の概要
- `支出額`: 支出額（百万円）
- `入札者数`: 入札参加者数
- `落札率`: 落札率（%）
- `契約方式等`: 契約方式（一般競争入札、随意契約等）
- `一者応札理由`: 一者応札の場合の理由

**レコード数**: 年度ごとに約6.7万〜8.0万件

**データ形式の違い**:
- **2014年**: グループ形式（`支出先上位１０者リスト-グループ-{field}-{num}`）
- **2015年以降**: ブロック形式（`支出先上位１０者リスト-{Block}.支払先-{num}-{field}`）

## 予算事業ID

### 仕様
- **形式**: 整数（1から開始）
- **スコープ**: 各年度内で独立した通し番号
- **連続性**: 欠番なし
- **紐付け**: 3テーブル間で同一ID

### ID範囲（年度別）

| 年度 | ID範囲 | 事業数 |
|------|--------|--------|
| 2014 | 1 - 4,739 | 4,739 |
| 2015 | 1 - 5,365 | 5,365 |
| 2016 | 1 - 5,221 | 5,221 |
| 2017 | 1 - 5,166 | 5,166 |
| 2018 | 1 - 5,148 | 5,148 |
| 2019 | 1 - 5,198 | 5,198 |
| 2020 | 1 - 5,445 | 5,445 |
| 2021 | 1 - 5,440 | 5,440 |
| 2022 | 1 - 5,394 | 5,394 |
| 2023 | 1 - 5,441 | 5,441 |

### 紐付け例

**2023年度 ID=100 の場合**:

```
基本情報 (1-2):
  ID=100, 事業名="原子力災害時避難円滑化モデル実証事業"
  → 1レコード

予算・執行 (2-1):
  ID=100, 予算年度=2010, 当初予算額=50.0
  ID=100, 予算年度=2011, 当初予算額=45.0
  ...
  → 15レコード（複数年度分）

支出先 (5-1):
  ID=100, 支出先番号=1, 支出先名="○○株式会社", 支出額=25.0
  ID=100, 支出先番号=2, 支出先名="△△団体", 支出額=15.0
  ...
  → 28レコード（最大10支出先 × ブロック数）
```

## データ品質

### 正規化処理
- **日本語テキスト**: neologdnによる統一化
- **全角/半角**: 数字・英字は半角、カタカナは全角に統一
- **和暦**: すべて西暦4桁に変換
- **欠損値**: 空文字列、"N/A"、"-"等を統一

### データ制約
- **必須フィールド**: 予算事業ID、事業年度、事業名
- **数値フィールド**: 金額は百万円単位、小数点以下1桁まで
- **文字コード**: UTF-8 with BOM

## 使用例

### SQL (DuckDB)

```sql
-- 2023年度の各府省庁別予算総額
SELECT
  b.府省庁,
  COUNT(DISTINCT b.予算事業ID) AS 事業数,
  SUM(p.当初予算額) AS 予算総額
FROM '1-2_2023_基本情報_事業概要.csv' b
JOIN '2-1_2023_予算・執行_サマリ.csv' p
  ON b.予算事業ID = p.予算事業ID
WHERE p.予算年度 = 2023
GROUP BY b.府省庁
ORDER BY 予算総額 DESC;

-- 支出先ランキング
SELECT
  s.支出先名,
  COUNT(*) AS 出現回数,
  SUM(s.支出額) AS 支出総額
FROM '5-1_2023_支出先_支出情報.csv' s
GROUP BY s.支出先名
ORDER BY 支出総額 DESC
LIMIT 20;
```

### Python (pandas)

```python
import pandas as pd

# データ読み込み
overview = pd.read_csv('1-2_2023_基本情報_事業概要.csv')
budget = pd.read_csv('2-1_2023_予算・執行_サマリ.csv')
expenditure = pd.read_csv('5-1_2023_支出先_支出情報.csv')

# 特定事業の詳細取得
business_id = 100
business = overview[overview['予算事業ID'] == business_id]
business_budget = budget[budget['予算事業ID'] == business_id]
business_exp = expenditure[expenditure['予算事業ID'] == business_id]

print(f"事業名: {business['事業名'].values[0]}")
print(f"予算レコード数: {len(business_budget)}")
print(f"支出先数: {len(business_exp)}")
```
