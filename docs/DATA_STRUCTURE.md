# データ構造仕様

## 概要

RSシステム2024形式の**12種類のテーブル**で構成され、予算事業IDによって紐付けられています。
Phase 2完了により、基本3ファイル（1-2, 2-1, 5-1）に加えて9種類の新規ファイルを生成します。

## テーブル構成

### 基本情報系（1-X）

#### 1-1. 組織情報

**ファイル名**: `1-1_{year}_組織情報.csv`

府省・部局・課室の組織階層情報。1行=1事業。

**主要カラム** (22列):
- `予算事業ID`: 年度内での通し番号（1から開始）
- `事業年度`: 対象年度（西暦4桁）
- `府省庁コード`, `府省庁名`: 府省レベルの情報
- `部局コード`, `部局名`: 部局レベルの情報
- `課室コード`, `課室名`: 課室レベルの情報
- `担当部局名`, `担当課室名`: 実際の担当組織

**レコード数**: 年度ごとに約4,700〜5,500件

#### 1-2. 基本情報・事業概要

**ファイル名**: `1-2_{year}_基本情報_事業概要.csv`

各事業の基本情報を格納。1行=1事業。

**主要カラム**:
- `予算事業ID`: 年度内での通し番号（1から開始）
- `事業年度`: 対象年度（西暦4桁）
- `事業名`: 事業の正式名称
- `府省庁`: 実施府省庁名
- `事業の目的`: 事業の目的説明
- `事業開始年度`: 事業開始年（西暦）
- `事業終了(予定)年度`: 事業終了予定年（西暦）

**レコード数**: 年度ごとに約4,700〜5,500件

#### 1-3. 政策・施策、法令等

**ファイル名**: `1-3_{year}_政策・施策、法令等.csv`

政策体系・根拠法令情報。1行=1事業。

**主要カラム** (28列):
- `予算事業ID`: 基本情報テーブルと紐付くID
- `政策目標番号`, `政策目標`: 最上位の政策目標
- `施策目標番号`, `施策目標`: 施策レベルの目標
- `達成目標番号`, `達成目標`: 達成すべき目標
- `根拠法令`: 事業の根拠となる法令

**レコード数**: 年度ごとに約4,700〜5,500件

#### 1-4. 補助率等

**ファイル名**: `1-4_{year}_補助率等.csv`

補助率・負担割合情報。1行=1事業。

**主要カラム** (18列):
- `予算事業ID`: 基本情報テーブルと紐付くID
- `補助率`: 補助率（%）
- `国庫負担割合`: 国の負担割合
- `地方負担割合`: 地方の負担割合
- `補助対象`: 補助対象の説明

**レコード数**: 年度ごとに約4,700〜5,500件（補助事業のみ）

#### 1-5. 関連事業

**ファイル名**: `1-5_{year}_関連事業.csv`

統合・分割等の関連事業情報。1行=1事業。

**主要カラム** (17列):
- `予算事業ID`: 基本情報テーブルと紐付くID
- `関連事業種別`: 統合/分割/移管等
- `関連事業名`: 関連する事業名
- `関連年度`: 関連が発生した年度

**レコード数**: 年度ごとに約500〜1,000件（関連事業がある場合のみ）

### 予算・執行系（2-X）

#### 2-1. 予算・執行サマリ

**ファイル名**: `2-1_{year}_予算・執行_サマリ.csv`

各事業の予算・執行額を年度別に展開。1事業につき複数年度のレコードを持つ。

**主要カラム**:
- `予算事業ID`: 基本情報テーブルと紐付くID
- `予算年度`: 予算の対象年度
- `当初予算額`: 当初予算額（百万円）
- `補正予算額`: 補正後予算額（百万円）
- `繰越額`: 前年度からの繰越額
- `予算現額`: 実際の予算総額
- `執行額`: 実際の執行額
- `執行率`: 執行率（%）
- `翌年度繰越額`: 翌年度への繰越額

**レコード数**:
- 2014年: 約2.4万件（1事業あたり平均5年度分）
- 2023年: 約2.1万件（空データフィルタ適用後）

**注意点**:
- 2014年は2桁年号形式（`-23年度` = 平成23年度）も含む
- 令和・平成の和暦も西暦に変換済み
- v1.0.3+: 空データフィルタにより実データのある年度のみ格納（約70%削減）

#### 2-2. 予算種別・歳出予算項目

**ファイル名**: `2-2_{year}_予算種別・歳出予算項目.csv`

予算種別の詳細展開。1事業×1年度につき複数レコード。

**主要カラム** (26列):
- `予算事業ID`: 基本情報テーブルと紐付くID
- `予算年度`: 予算の対象年度
- `会計区分`, `会計`, `勘定`: 会計情報
- `予算種別`: 当初/補正/繰越等
- `歳出予算項目`: 項・目・事項レベルの予算項目

**レコード数**: 年度ごとに約2〜5万件

### 評価系（4-X）

#### 4-1. 点検・評価

**ファイル名**: `4-1_{year}_点検・評価.csv`

評価結果・改善方針。1行=1事業。

**主要カラム** (37列):
- `予算事業ID`: 基本情報テーブルと紐付くID
- `点検結果`: 点検の結果
- `評価結果`: 評価結果（S/A/B/C等）
- `外部有識者の所見`: 外部有識者による所見
- `改善方針`: 今後の改善方針
- `行政事業レビュー推進チームの所見`: 推進チームの所見

**レコード数**: 年度ごとに約4,700〜5,500件

### 支出先系（5-X）

#### 5-1. 支出先情報

**ファイル名**: `5-1_{year}_支出先_支出情報.csv`

各事業の支出先上位10者の詳細情報。1事業につき最大10レコード。

**主要カラム**:
- `予算事業ID`: 基本情報テーブルと紐付くID
- `支出先ブロック`: ブロック識別子（A, B, C等）※2015年以降
- `支出先番号`: 順位番号（1〜10）
- `支出先名`: 支出先の組織・企業名
- `法人番号`: 法人番号（13桁）
- `業務概要`: 業務の概要
- `支出額`: 支出額（百万円）
- `入札者数`: 入札参加者数
- `落札率`: 落札率（%）
- `契約方式等`: 契約方式（一般競争入札、随意契約等）
- `一者応札理由`: 一者応札の場合の理由

**レコード数**: 年度ごとに約6.7万〜8.0万件

**データ形式の違い**:
- **2014年**: グループ形式（`支出先上位１０者リスト-グループ-{field}-{num}`）
- **2015年以降**: ブロック形式（`支出先上位１０者リスト-{Block}.支払先-{num}-{field}`）

#### 5-3. 費目・使途

**ファイル名**: `5-3_{year}_費目・使途.csv`

費目別使途詳細。1事業につき複数レコード（費目ごと）。

**主要カラム** (20列):
- `予算事業ID`: 基本情報テーブルと紐付くID
- `費目`: 費目名（人件費/事業費等）
- `使途`: 具体的な使途
- `金額`: 費目別の金額（百万円）

**レコード数**: 年度ごとに約1〜3万件

#### 5-4. 国庫債務負担行為等による契約

**ファイル名**: `5-4_{year}_国庫債務負担行為等による契約.csv`

複数年度契約情報。1事業につき複数レコード（契約ごと）。

**主要カラム** (27列):
- `予算事業ID`: 基本情報テーブルと紐付くID
- `契約件名`: 契約の件名
- `契約開始年度`, `契約終了年度`: 契約期間
- `契約総額`: 契約の総額（百万円）
- `当該年度支出予定額`: 当該年度の支出予定額

**レコード数**: 年度ごとに約500〜2,000件（複数年度契約がある場合のみ）

### その他（6-X）

#### 6-1. その他備考

**ファイル名**: `6-1_{year}_その他備考.csv`

特記事項・備考情報。1行=1事業。

**主要カラム** (14列):
- `予算事業ID`: 基本情報テーブルと紐付くID
- `特記事項`: 特記すべき事項
- `備考`: その他の備考
- `留意点`: 留意すべき点

**レコード数**: 年度ごとに約4,700〜5,500件

## 予算事業ID

### 仕様
- **形式**: 整数（1から開始）
- **スコープ**: 各年度内で独立した通し番号
- **連続性**: 欠番なし
- **紐付け**: 全12テーブル間で同一ID

### ID範囲（年度別）

| 年度 | ID範囲 | 事業数 |
|------|--------|--------|
| 2014 | 1 - 4,739 | 4,739 |
| 2015 | 1 - 5,365 | 5,365 |
| 2016 | 1 - 5,221 | 5,221 |
| 2017 | 1 - 5,166 | 5,166 |
| 2018 | 1 - 5,148 | 5,148 |
| 2019 | 1 - 5,198 | 5,198 |
| 2020 | 1 - 5,445 | 5,445 |
| 2021 | 1 - 5,440 | 5,440 |
| 2022 | 1 - 5,394 | 5,394 |
| 2023 | 1 - 5,441 | 5,441 |

### 紐付け例

**2023年度 ID=100 の場合**:

```
組織情報 (1-1):
  ID=100, 府省庁名="内閣府", 部局名="政策統括官（原子力防災担当）"
  → 1レコード

基本情報 (1-2):
  ID=100, 事業名="原子力災害時避難円滑化モデル実証事業"
  → 1レコード

政策・法令 (1-3):
  ID=100, 政策目標="原子力災害への対応", 根拠法令="原子力災害対策特別措置法"
  → 1レコード

予算・執行 (2-1):
  ID=100, 予算年度=2010, 当初予算額=50.0
  ID=100, 予算年度=2011, 当初予算額=45.0
  ...
  → 15レコード（複数年度分）

評価 (4-1):
  ID=100, 評価結果="A", 改善方針="継続実施"
  → 1レコード

支出先 (5-1):
  ID=100, 支出先番号=1, 支出先名="○○株式会社", 支出額=25.0
  ID=100, 支出先番号=2, 支出先名="△△団体", 支出額=15.0
  ...
  → 28レコード（最大10支出先 × ブロック数）

備考 (6-1):
  ID=100, 特記事項="モデル事業として実施"
  → 1レコード
```

## データ品質

### 正規化処理
- **日本語テキスト**: neologdnによる統一化
- **全角/半角**: 数字・英字は半角、カタカナは全角に統一
- **和暦**: すべて西暦4桁に変換
- **欠損値**: 空文字列、"N/A"、"-"等を統一

### データ制約
- **必須フィールド**: 予算事業ID、事業年度、事業名
- **数値フィールド**: 金額は百万円単位、小数点以下1桁まで
- **文字コード**: UTF-8 with BOM

### データ単位の重要な注意 ⚠️

**金額データの単位が年度により異なります**:

| データソース | 年度 | 単位 | 例 |
|-------------|------|------|-----|
| 本パイプライン出力 | 2014-2023 | **百万円** | `29` = 2,900万円 |
| RSシステム2024 | 2024+ | **円（1円）** | `29,457,000` = 約2,946万円 |

**影響**: 本パイプラインの出力（2014-2023）とRSシステム2024以降のデータを直接比較すると100万倍の差が生じます。比較前に必ず単位変換が必要です。

## 使用例

### SQL (DuckDB)

```sql
-- 2023年度の各府省庁別予算総額（組織情報と結合）
SELECT
  o.府省庁名,
  COUNT(DISTINCT b.予算事業ID) AS 事業数,
  SUM(p.当初予算額) AS 予算総額
FROM '1-2_2023_基本情報_事業概要.csv' b
JOIN '1-1_2023_組織情報.csv' o
  ON b.予算事業ID = o.予算事業ID
JOIN '2-1_2023_予算・執行_サマリ.csv' p
  ON b.予算事業ID = p.予算事業ID
WHERE p.予算年度 = 2023
GROUP BY o.府省庁名
ORDER BY 予算総額 DESC;

-- 評価結果別の事業数
SELECT
  e.評価結果,
  COUNT(*) AS 事業数,
  AVG(p.執行率) AS 平均執行率
FROM '4-1_2023_点検・評価.csv' e
JOIN '2-1_2023_予算・執行_サマリ.csv' p
  ON e.予算事業ID = p.予算事業ID
WHERE p.予算年度 = 2023
GROUP BY e.評価結果
ORDER BY 事業数 DESC;

-- 支出先ランキング
SELECT
  s.支出先名,
  COUNT(*) AS 出現回数,
  SUM(s.支出額) AS 支出総額
FROM '5-1_2023_支出先_支出情報.csv' s
GROUP BY s.支出先名
ORDER BY 支出総額 DESC
LIMIT 20;
```

### Python (pandas)

```python
import pandas as pd

# データ読み込み（全12ファイル）
org = pd.read_csv('1-1_2023_組織情報.csv')
overview = pd.read_csv('1-2_2023_基本情報_事業概要.csv')
policy = pd.read_csv('1-3_2023_政策・施策、法令等.csv')
subsidy = pd.read_csv('1-4_2023_補助率等.csv')
related = pd.read_csv('1-5_2023_関連事業.csv')
budget = pd.read_csv('2-1_2023_予算・執行_サマリ.csv')
budget_type = pd.read_csv('2-2_2023_予算種別・歳出予算項目.csv')
evaluation = pd.read_csv('4-1_2023_点検・評価.csv')
expenditure = pd.read_csv('5-1_2023_支出先_支出情報.csv')
expense = pd.read_csv('5-3_2023_費目・使途.csv')
contract = pd.read_csv('5-4_2023_国庫債務負担行為等による契約.csv')
remarks = pd.read_csv('6-1_2023_その他備考.csv')

# 特定事業の詳細取得（全テーブル統合）
business_id = 100
business_info = overview[overview['予算事業ID'] == business_id]
business_org = org[org['予算事業ID'] == business_id]
business_budget = budget[budget['予算事業ID'] == business_id]
business_eval = evaluation[evaluation['予算事業ID'] == business_id]
business_exp = expenditure[expenditure['予算事業ID'] == business_id]

print(f"事業名: {business_info['事業名'].values[0]}")
print(f"府省庁: {business_org['府省庁名'].values[0]}")
print(f"評価結果: {business_eval['評価結果'].values[0]}")
print(f"予算レコード数: {len(business_budget)}")
print(f"支出先数: {len(business_exp)}")
```
